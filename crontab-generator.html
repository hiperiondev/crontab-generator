<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cron Expression Generator</title>
    <style>
        body {
            font-family: Verdana, Arial, sans-serif;
            font-size: 12px;
            color: #333333;
            background-color: #F6F6F6;
            margin: 0;
            padding: 0;
        }
        #container {
            width: 960px;
            margin: 0 auto;
            background-color: #FFFFFF;
            border: 1px solid #CCCCCC;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        #header {
            background-color: #0066CC;
            color: #FFFFFF;
            padding: 10px 20px;
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
        }
        #nav {
            background-color: #E6E6E6;
            padding: 10px 20px;
            border-bottom: 1px solid #CCCCCC;
        }
        #content {
            padding: 20px;
            min-height: 400px;
        }
        #cron-generator {
            max-width: 900px;
            margin: 0 auto;
        }
        h2 {
            font-family: Verdana, Arial, sans-serif;
            font-size: 24px;
            font-weight: bold;
            color: #0066CC;
            margin: 0 0 20px 0;
            text-align: left;
        }
        h3 {
            font-size: 16px;
            font-weight: bold;
            color: #333333;
            margin: 20px 0 10px 0;
        }
        .tabs {
            overflow: hidden;
            border-bottom: 2px solid #0066CC;
            margin-bottom: 20px;
        }
        .tab-button {
            background-color: #E6E6E6;
            float: left;
            border: 1px solid #CCCCCC;
            border-bottom: none;
            outline: none;
            cursor: pointer;
            padding: 8px 15px;
            font-size: 12px;
            margin-right: 5px;
            border-radius: 5px 5px 0 0;
        }
        .tab-button:hover {
            background-color: #D9D9D9;
        }
        .tab-button.active {
            background-color: #0066CC;
            color: #FFFFFF;
            border-color: #0066CC;
        }
        .tab-content {
            display: none;
            padding: 15px;
            border: 1px solid #CCCCCC;
            border-top: none;
            background-color: #F9F9F9;
        }
        .tab-content.active {
            display: block;
        }
        label {
            font-weight: bold;
            margin-right: 10px;
            display: inline-block;
            width: 250px;
            font-size: 12px;
            color: #333333;
        }
        select, input[type="text"] {
            padding: 5px;
            margin: 5px 0;
            border: 1px solid #CCCCCC;
            border-radius: 3px;
            width: 150px;
            font-size: 12px;
            font-family: Verdana, Arial, sans-serif;
            background-color: #FFFFFF;
        }
        .option-group {
            margin-top: 10px;
            display: none;
        }
        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(15, 1fr);
            gap: 2px;
            padding: 5px;
            margin-top: 5px;
            max-height: 80px;
            overflow-y: auto;
        }
        .checkbox-grid label {
            width: auto;
            font-weight: normal;
            margin: 0;
            display: flex;
            align-items: center;
            font-size: 10px;
            color: #333333;
        }
        .checkbox-grid label input[type="checkbox"] {
            margin-right: 2px;
        }
        #cron-expression {
            margin-top: 20px;
        }
        #cron-output {
            width: 70%;
            padding: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            background-color: #E6E6E6;
            border: 1px solid #CCCCCC;
            border-radius: 3px;
        }
        button {
            padding: 8px 15px;
            background-color: #0066CC;
            color: #FFFFFF;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }
        button:hover {
            background-color: #0055AA;
        }
        #mode-switch {
            background-color: #4CAF50;
        }
        #mode-switch:hover {
            background-color: #45a049;
        }
        #next-runs {
            margin-top: 20px;
        }
        #next-runs-list {
            list-style: none;
            padding: 0;
        }
        #next-runs-list li {
            padding: 5px 0;
            color: #333333;
            font-size: 12px;
        }
        .radio-group {
            margin: 10px 0;
        }
        .radio-group label {
            width: auto;
            margin-right: 20px;
            font-weight: normal;
        }
        .error-message {
            color: #CC0000;
            font-size: 11px;
            margin-left: 260px;
            display: none;
        }
        #footer {
            background-color: #E6E6E6;
            padding: 10px 20px;
            border-top: 1px solid #CCCCCC;
            text-align: center;
            font-size: 11px;
            color: #666666;
        }
    </style>
</head>
<body>
    <div id="container">
        <div id="header"></div>
        <div id="nav"></div>
        <div id="content">
            <div id="cron-generator">
                <h2>Cron Expression Generator</h2>
                <div style="margin-bottom: 20px;">
                    <button id="mode-switch">Switch to Linux Crontab</button>
                </div>
                <div class="tabs" id="tabs">
                    <button class="tab-button active" data-tab="seconds">Seconds</button>
                    <button class="tab-button" data-tab="minutes">Minutes</button>
                    <button class="tab-button" data-tab="hours">Hours</button>
                    <button class="tab-button" data-tab="day">Day</button>
                    <button class="tab-button" data-tab="month">Month</button>
                    <button class="tab-button" data-tab="year">Year</button>
                </div>

                <!-- Seconds Tab -->
                <div id="seconds" class="tab-content active">
                    <label for="seconds-type">Seconds:</label>
                    <select id="seconds-type">
                        <option value="every">At each second</option>
                        <option value="increment">Every X seconds starting at second Y</option>
                        <option value="specific">Specific seconds</option>
                        <option value="range">Between second X and second Y</option>
                    </select>
                    <div id="seconds-increment" class="option-group">
                        <label for="seconds-increment-step">Every X seconds:</label>
                        <select id="seconds-increment-step">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="5">5</option>
                            <option value="10">10</option>
                            <option value="15">15</option>
                            <option value="30">30</option>
                        </select>
                        <label for="seconds-increment-start">Starting at second:</label>
                        <select id="seconds-increment-start"></select>
                    </div>
                    <div id="seconds-specific" class="option-group">
                        <label>Select seconds (0-59):</label>
                        <div class="checkbox-grid" id="seconds-specific-grid"></div>
                    </div>
                    <div id="seconds-range" class="option-group">
                        <label for="seconds-range-start">Between second:</label>
                        <select id="seconds-range-start"></select>
                        <label for="seconds-range-end">And second:</label>
                        <select id="seconds-range-end"></select>
                    </div>
                </div>

                <!-- Minutes Tab -->
                <div id="minutes" class="tab-content">
                    <label for="minutes-type">Minutes:</label>
                    <select id="minutes-type">
                        <option value="every">At each minute</option>
                        <option value="increment">Every X minutes starting at minute Y</option>
                        <option value="specific">Specific minutes</option>
                        <option value="range">Between minute X and minute Y</option>
                    </select>
                    <div id="minutes-increment" class="option-group">
                        <label for="minutes-increment-step">Every X minutes:</label>
                        <select id="minutes-increment-step">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="5">5</option>
                            <option value="10">10</option>
                            <option value="15">15</option>
                            <option value="30">30</option>
                        </select>
                        <label for="minutes-increment-start">Starting at minute:</label>
                        <select id="minutes-increment-start"></select>
                    </div>
                    <div id="minutes-specific" class="option-group">
                        <label>Select minutes (0-59):</label>
                        <div class="checkbox-grid" id="minutes-specific-grid"></div>
                    </div>
                    <div id="minutes-range" class="option-group">
                        <label for="minutes-range-start">Between minute:</label>
                        <select id="minutes-range-start"></select>
                        <label for="minutes-range-end">And minute:</label>
                        <select id="minutes-range-end"></select>
                    </div>
                </div>

                <!-- Hours Tab -->
                <div id="hours" class="tab-content">
                    <label for="hours-type">Hours:</label>
                    <select id="hours-type">
                        <option value="every">Every hour</option>
                        <option value="increment">Every X hours starting at hour Y</option>
                        <option value="specific">Specific hours</option>
                        <option value="range">Between hour X and hour Y</option>
                    </select>
                    <div id="hours-increment" class="option-group">
                        <label for="hours-increment-step">Every X hours:</label>
                        <select id="hours-increment-step">
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="6">6</option>
                            <option value="12">12</option>
                        </select>
                        <label for="hours-increment-start">Starting at hour:</label>
                        <select id="hours-increment-start"></select>
                    </div>
                    <div id="hours-specific" class="option-group">
                        <label>Select hours (0-23):</label>
                        <div class="checkbox-grid" id="hours-specific-grid"></div>
                    </div>
                    <div id="hours-range" class="option-group">
                        <label for="hours-range-start">Between hour:</label>
                        <select id="hours-range-start"></select>
                        <label for="hours-range-end">And hour:</label>
                        <select id="hours-range-end"></select>
                    </div>
                </div>

                <!-- Day Tab -->
                <div id="day" class="tab-content">
                    <div class="radio-group">
                        <label><input type="radio" name="day-mode" value="dayOfMonth" checked>Day of Month</label>
                        <label><input type="radio" name="day-mode" value="dayOfWeek">Day of Week</label>
                    </div>
                    <div id="day-dayOfMonth">
                        <label for="day-dom-type">Day of Month:</label>
                        <select id="day-dom-type">
                            <option value="every">Every day</option>
                            <option value="increment">Every X days starting at day Y</option>
                            <option value="specific">Specific days</option>
                            <option value="last">Last day of month</option>
                            <option value="lastWeekday">Last weekday of month</option>
                            <option value="weekday">Every weekday</option>
                        </select>
                        <div id="day-dom-increment" class="option-group">
                            <label for="day-dom-increment-step">Every X days:</label>
                            <select id="day-dom-increment-step">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                                <option value="6">6</option>
                                <option value="7">7</option>
                            </select>
                            <label for="day-dom-increment-start">Starting at day:</label>
                            <select id="day-dom-increment-start"></select>
                        </div>
                        <div id="day-dom-specific" class="option-group">
                            <label>Select days (1-31):</label>
                            <div class="checkbox-grid" id="day-dom-specific-grid"></div>
                        </div>
                    </div>
                    <div id="day-dayOfWeek" style="display: none;">
                        <label for="day-dow-type">Day of Week:</label>
                        <select id="day-dow-type">
                            <option value="every">Every day</option>
                            <option value="specific">Specific days</option>
                            <option value="last">Last</option>
                            <option value="nth">Nth day</option>
                        </select>
                        <div id="day-dow-specific" class="option-group">
                            <label>Select days (0-6, 0=Sunday):</label>
                            <div class="checkbox-grid" id="day-dow-specific-grid">
                                <label><input type="checkbox" value="0">Sun (0)</label>
                                <label><input type="checkbox" value="1">Mon (1)</label>
                                <label><input type="checkbox" value="2">Tue (2)</label>
                                <label><input type="checkbox" value="3">Wed (3)</label>
                                <label><input type="checkbox" value="4">Thu (4)</label>
                                <label><input type="checkbox" value="5">Fri (5)</label>
                                <label><input type="checkbox" value="6">Sat (6)</label>
                            </div>
                        </div>
                        <div id="day-dow-nth" class="option-group">
                            <label for="day-dow-nth-n">Nth:</label>
                            <select id="day-dow-nth-n">
                                <option value="1">1st</option>
                                <option value="2">2nd</option>
                                <option value="3">3rd</option>
                                <option value="4">4th</option>
                                <option value="5">5th</option>
                            </select>
                            <label for="day-dow-nth-day">Day:</label>
                            <select id="day-dow-nth-day">
                                <option value="0">Sunday</option>
                                <option value="1">Monday</option>
                                <option value="2">Tuesday</option>
                                <option value="3">Wednesday</option>
                                <option value="4">Thursday</option>
                                <option value="5">Friday</option>
                                <option value="6">Saturday</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Month Tab -->
                <div id="month" class="tab-content">
                    <label for="month-type">Month:</label>
                    <select id="month-type">
                        <option value="every">Every month</option>
                        <option value="specific">Specific months</option>
                        <option value="range">Between month X and month Y</option>
                    </select>
                    <div id="month-specific" class="option-group">
                        <label>Select months (1-12):</label>
                        <div class="checkbox-grid" id="month-specific-grid">
                            <label><input type="checkbox" value="1">Jan (1)</label>
                            <label><input type="checkbox" value="2">Feb (2)</label>
                            <label><input type="checkbox" value="3">Mar (3)</label>
                            <label><input type="checkbox" value="4">Apr (4)</label>
                            <label><input type="checkbox" value="5">May (5)</label>
                            <label><input type="checkbox" value="6">Jun (6)</label>
                            <label><input type="checkbox" value="7">Jul (7)</label>
                            <label><input type="checkbox" value="8">Aug (8)</label>
                            <label><input type="checkbox" value="9">Sep (9)</label>
                            <label><input type="checkbox" value="10">Oct (10)</label>
                            <label><input type="checkbox" value="11">Nov (11)</label>
                            <label><input type="checkbox" value="12">Dec (12)</label>
                        </div>
                    </div>
                    <div id="month-range" class="option-group">
                        <label for="month-range-start">Between month:</label>
                        <select id="month-range-start">
                            <option value="1">Jan (1)</option>
                            <option value="2">Feb (2)</option>
                            <option value="3">Mar (3)</option>
                            <option value="4">Apr (4)</option>
                            <option value="5">May (5)</option>
                            <option value="6">Jun (6)</option>
                            <option value="7">Jul (7)</option>
                            <option value="8">Aug (8)</option>
                            <option value="9">Sep (9)</option>
                            <option value="10">Oct (10)</option>
                            <option value="11">Nov (11)</option>
                            <option value="12">Dec (12)</option>
                        </select>
                        <label for="month-range-end">And month:</label>
                        <select id="month-range-end">
                            <option value="1">Jan (1)</option>
                            <option value="2">Feb (2)</option>
                            <option value="3">Mar (3)</option>
                            <option value="4">Apr (4)</option>
                            <option value="5">May (5)</option>
                            <option value="6">Jun (6)</option>
                            <option value="7">Jul (7)</option>
                            <option value="8">Aug (8)</option>
                            <option value="9">Sep (9)</option>
                            <option value="10">Oct (10)</option>
                            <option value="11">Nov (11)</option>
                            <option value="12" selected>Dec (12)</option>
                        </select>
                    </div>
                </div>

                <!-- Year Tab -->
                <div id="year" class="tab-content">
                    <label for="year-type">Year:</label>
                    <select id="year-type">
                        <option value="every">Every year</option>
                        <option value="specific">Specific years</option>
                        <option value="range">Between year X and year Y</option>
                    </select>
                    <div id="year-specific" class="option-group">
                        <label for="year-specific-input">Enter years (e.g., 2025,2026):</label>
                        <input type="text" id="year-specific-input" placeholder="2025,2026">
                        <span id="year-specific-error" class="error-message"></span>
                    </div>
                    <div id="year-range" class="option-group">
                        <label for="year-range-start">Between year:</label>
                        <select id="year-range-start">
                            <option value="2025">2025</option>
                            <option value="2026">2026</option>
                            <option value="2027">2027</option>
                            <option value="2028">2028</option>
                            <option value="2029">2029</option>
                            <option value="2030">2030</option>
                        </select>
                        <label for="year-range-end">And year:</label>
                        <select id="year-range-end">
                            <option value="2025">2025</option>
                            <option value="2026">2026</option>
                            <option value="2027">2027</option>
                            <option value="2028">2028</option>
                            <option value="2029">2029</option>
                            <option value="2030" selected>2030</option>
                        </select>
                    </div>
                </div>

                <!-- Cron Expression Output -->
                <div id="cron-expression">
                    <h3>Cron Expression</h3>
                    <input type="text" id="cron-output" readonly>
                    <button id="copy-button">Copy</button>
                </div>

                <!-- Next Runs -->
                <div id="next-runs">
                    <h3>Next Runs</h3>
                    <button id="calculate-button">Calculate Next Runs</button>
                    <ul id="next-runs-list"></ul>
                </div>
            </div>
        </div>
        <div id="footer"></div>
    </div>

    <script>
        // Centralized cache for checkboxes
        const checkboxCache = {};

        // Arrays to store selected checkbox values
        let selectedSeconds = [];
        let selectedMinutes = [];
        let selectedHours = [];
        let selectedDaysOfMonth = [];
        let selectedMonths = [];
        let selectedDaysOfWeek = [];

        // Mode flag: 'quartz' or 'linux'
        let currentMode = 'quartz';

        // Generate options for select elements
        function generateOptions(select, start, end, selectedValue) {
            select.innerHTML = '';
            for (let i = start; i <= end; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                if (i === selectedValue) option.selected = true;
                select.appendChild(option);
            }
        }

        // Generate checkboxes and cache them
        function generateCheckboxes(containerId, start, end) {
            const grid = document.getElementById(containerId + '-grid');
            grid.innerHTML = '';
            for (let i = start; i <= end; i++) {
                const label = document.createElement('label');
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.value = i;
                label.appendChild(checkbox);
                label.appendChild(document.createTextNode(i));
                grid.appendChild(label);
            }
            checkboxCache[containerId + '-grid'] = grid.querySelectorAll('input[type="checkbox"]');
        }

        // Tab switching
        function openTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-button').forEach(button => button.classList.remove('active'));
            const tabContent = document.getElementById(tabName);
            const tabButton = document.querySelector(`.tab-button[data-tab="${tabName}"]`);
            if (tabContent && tabButton) {
                tabContent.classList.add('active');
                tabButton.classList.add('active');
            }
        }

        // Update option visibility
        function updateOptions(tab, typeId, groups) {
            const type = document.getElementById(typeId).value;
            groups.forEach(group => {
                const element = document.getElementById(`${tab}-${group}`);
                element.style.display = (type === group) ? 'block' : 'none';
            });
            updateCron();
        }

        function updateSecondsOptions() {
            updateOptions('seconds', 'seconds-type', ['increment', 'specific', 'range']);
        }

        function updateMinutesOptions() {
            updateOptions('minutes', 'minutes-type', ['increment', 'specific', 'range']);
        }

        function updateHoursOptions() {
            updateOptions('hours', 'hours-type', ['increment', 'specific', 'range']);
        }

        function updateDayOptions() {
            const mode = document.querySelector('input[name="day-mode"]:checked').value;
            document.getElementById('day-dayOfMonth').style.display = mode === 'dayOfMonth' ? 'block' : 'none';
            document.getElementById('day-dayOfWeek').style.display = mode === 'dayOfWeek' ? 'block' : 'none';
            updateDaySubOptions();
            updateCron();
        }

        function updateDaySubOptions() {
            const mode = document.querySelector('input[name="day-mode"]:checked').value;
            if (mode === 'dayOfMonth') {
                updateOptions('day-dom', 'day-dom-type', ['increment', 'specific']);
            } else {
                updateOptions('day-dow', 'day-dow-type', ['specific', 'nth']);
            }
        }

        function updateMonthOptions() {
            updateOptions('month', 'month-type', ['specific', 'range']);
        }

        function updateYearOptions() {
            updateOptions('year', 'year-type', ['specific', 'range']);
        }

        // Toggle between Quartz and Linux modes
        function toggleMode() {
            const modeSwitch = document.getElementById('mode-switch');
            const tabs = document.getElementById('tabs');
            const secondsTab = document.getElementById('seconds');
            const yearTab = document.getElementById('year');
            const secondsTabButton = document.querySelector('.tab-button[data-tab="seconds"]');
            const yearTabButton = document.querySelector('.tab-button[data-tab="year"]');
            if (currentMode === 'quartz') {
                currentMode = 'linux';
                modeSwitch.textContent = 'Switch to Quartz Scheduler';
                secondsTab.style.display = 'none';
                yearTab.style.display = 'none';
                secondsTabButton.style.display = 'none';
                yearTabButton.style.display = 'none';
                openTab('minutes');
            } else {
                currentMode = 'quartz';
                modeSwitch.textContent = 'Switch to Linux Crontab';
                secondsTab.style.display = 'block';
                yearTab.style.display = 'block';
                secondsTabButton.style.display = 'inline-block';
                yearTabButton.style.display = 'inline-block';
                openTab('seconds');
            }
            updateCron();
        }

        // Get cron field values
        function getFieldValue(tab, selectedValues, defaultValue = '*') {
            const type = document.getElementById(`${tab}-type`).value;
            if (type === 'every') return '*';
            if (type === 'increment') {
                const start = document.getElementById(`${tab}-increment-start`).value;
                const step = document.getElementById(`${tab}-increment-step`).value;
                return currentMode === 'linux' && tab === 'day-dom' ? `*/${step}` : `${start}/${step}`;
            }
            if (type === 'specific') {
                return selectedValues.length ? selectedValues.join(',') : defaultValue;
            }
            if (type === 'range') {
                const start = document.getElementById(`${tab}-range-start`).value;
                const end = document.getElementById(`${tab}-range-end`).value;
                return `${start}-${end}`;
            }
            return defaultValue;
        }

        function getSeconds() {
            if (currentMode === 'linux') return '';
            return getFieldValue('seconds', selectedSeconds, '0');
        }

        function getMinutes() {
            return getFieldValue('minutes', selectedMinutes);
        }

        function getHours() {
            return getFieldValue('hours', selectedHours);
        }

        function getDaysOfMonth() {
            const mode = document.querySelector('input[name="day-mode"]:checked').value;
            if (mode === 'dayOfWeek') return currentMode === 'linux' ? '*' : '?';
            const type = document.getElementById('day-dom-type').value;
            if (type === 'every') return '*';
            if (type === 'increment' || type === 'specific') return getFieldValue('day-dom', selectedDaysOfMonth);
            if (type === 'last') return currentMode === 'linux' ? '*' : 'L';
            if (type === 'lastWeekday') return currentMode === 'linux' ? '*' : 'LW';
            if (type === 'weekday') return currentMode === 'linux' ? '1-5' : '1-5';
            return '*';
        }

        function getDaysOfWeek() {
            const mode = document.querySelector('input[name="day-mode"]:checked').value;
            if (mode === 'dayOfMonth') return currentMode === 'linux' ? '*' : '?';
            const type = document.getElementById('day-dow-type').value;
            if (type === 'every') return '*';
            if (type === 'specific') {
                return selectedDaysOfWeek.length ?
                    (currentMode === 'linux' ?
                        selectedDaysOfWeek.map(d => (parseInt(d) + 1) % 7).join(',') :
                        selectedDaysOfWeek.join(',')) : '*';
            }
            if (type === 'last') return currentMode === 'linux' ? '*' : 'L';
            if (type === 'nth') {
                if (currentMode === 'linux') return '*';
                const n = document.getElementById('day-dow-nth-n').value;
                const day = document.getElementById('day-dow-nth-day').value;
                return `${day}#${n}`;
            }
            return '*';
        }

        function getMonths() {
            const type = document.getElementById('month-type').value;
            if (type === 'every') return '*';
            if (type === 'specific') {
                return selectedMonths.length ? selectedMonths.join(',') : '*';
            }
            if (type === 'range') {
                const start = document.getElementById('month-range-start').value;
                const end = document.getElementById('month-range-end').value;
                return `${start}-${end}`;
            }
            return '*';
        }

        function getYear() {
            if (currentMode === 'linux') return '';
            const type = document.getElementById('year-type').value;
            const errorElement = document.getElementById('year-specific-error');
            errorElement.style.display = 'none';
            if (type === 'every') return '*';
            if (type === 'specific') {
                const input = document.getElementById('year-specific-input').value.trim();
                if (!input) return '*';
                const years = input.split(',').map(y => y.trim()).filter(y => y);
                const validYears = years.filter(y => {
                    const num = Number(y);
                    return !isNaN(num) && Number.isInteger(num) && num >= 1970 && num <= 2099;
                });
                if (validYears.length !== years.length) {
                    errorElement.textContent = 'Invalid years (1970-2099, e.g., 2025,2026)';
                    errorElement.style.display = 'block';
                    return '*';
                }
                return validYears.join(',');
            }
            if (type === 'range') {
                const start = document.getElementById('year-range-start').value;
                const end = document.getElementById('year-range-end').value;
                return `${start}-${end}`;
            }
            return '*';
        }

        // Update cron expression with debouncing
        let debounceTimer;
        function updateCron() {
            clearTimeout(debounceTimer);
            debounceTimer = setTimeout(() => {
                let cron;
                if (currentMode === 'quartz') {
                    cron = [
                        getSeconds(),
                        getMinutes(),
                        getHours(),
                        getDaysOfMonth(),
                        getMonths(),
                        getDaysOfWeek(),
                        getYear()
                    ].join(' ');
                } else {
                    cron = [
                        getMinutes(),
                        getHours(),
                        getDaysOfMonth(),
                        getMonths(),
                        getDaysOfWeek()
                    ].join(' ');
                }
                document.getElementById('cron-output').value = cron;
            }, 300);
        }

        // Copy to clipboard
        document.getElementById('copy-button').addEventListener('click', () => {
            const cronOutput = document.getElementById('cron-output');
            if (navigator.clipboard) {
                navigator.clipboard.writeText(cronOutput.value)
                    .then(() => alert('Cron expression copied to clipboard!'))
                    .catch(() => alert('Failed to copy cron expression.'));
            } else {
                cronOutput.select();
                document.execCommand('copy');
                alert('Cron expression copied to clipboard!');
            }
        });

        // Simulate next runs
        document.getElementById('calculate-button').addEventListener('click', () => {
            const list = document.getElementById('next-runs-list');
            list.innerHTML = '';
            const now = new Date();
            for (let i = 0; i < 5; i++) {
                const next = new Date(now.getTime() + (i + 1) * 60000);
                const li = document.createElement('li');
                li.textContent = next.toLocaleString();
                list.appendChild(li);
            }
        });

        // Mode switch listener
        document.getElementById('mode-switch').addEventListener('click', toggleMode);

        // Initialization
        function init() {
            // Populate select options
            generateOptions(document.getElementById('seconds-increment-start'), 0, 59, 0);
            generateOptions(document.getElementById('seconds-range-start'), 0, 59, 0);
            generateOptions(document.getElementById('seconds-range-end'), 1, 59, 59);
            generateOptions(document.getElementById('minutes-increment-start'), 0, 59, 0);
            generateOptions(document.getElementById('minutes-range-start'), 0, 59, 0);
            generateOptions(document.getElementById('minutes-range-end'), 1, 59, 59);
            generateOptions(document.getElementById('hours-increment-start'), 0, 23, 0);
            generateOptions(document.getElementById('hours-range-start'), 0, 23, 0);
            generateOptions(document.getElementById('hours-range-end'), 1, 23, 23);
            generateOptions(document.getElementById('day-dom-increment-start'), 1, 31, 1);

            // Generate checkboxes
            generateCheckboxes('seconds-specific', 0, 59);
            generateCheckboxes('minutes-specific', 0, 59);
            generateCheckboxes('hours-specific', 0, 23);
            generateCheckboxes('day-dom-specific', 1, 31);

            // Add change listeners for checkboxes
            checkboxCache['seconds-specific-grid'].forEach(cb => {
                cb.addEventListener('change', () => {
                    selectedSeconds = Array.from(checkboxCache['seconds-specific-grid'])
                        .filter(cb => cb.checked)
                        .map(cb => cb.value);
                    updateCron();
                });
            });
            checkboxCache['minutes-specific-grid'].forEach(cb => {
                cb.addEventListener('change', () => {
                    selectedMinutes = Array.from(checkboxCache['minutes-specific-grid'])
                        .filter(cb => cb.checked)
                        .map(cb => cb.value);
                    updateCron();
                });
            });
            checkboxCache['hours-specific-grid'].forEach(cb => {
                cb.addEventListener('change', () => {
                    selectedHours = Array.from(checkboxCache['hours-specific-grid'])
                        .filter(cb => cb.checked)
                        .map(cb => cb.value);
                    updateCron();
                });
            });
            checkboxCache['day-dom-specific-grid'].forEach(cb => {
                cb.addEventListener('change', () => {
                    selectedDaysOfMonth = Array.from(checkboxCache['day-dom-specific-grid'])
                        .filter(cb => cb.checked)
                        .map(cb => cb.value);
                    updateCron();
                });
            });
            document.querySelectorAll('#month-specific-grid input[type="checkbox"]').forEach(cb => {
                cb.addEventListener('change', () => {
                    selectedMonths = Array.from(document.querySelectorAll('#month-specific-grid input[type="checkbox"]'))
                        .filter(cb => cb.checked)
                        .map(cb => cb.value);
                    updateCron();
                });
            });
            document.querySelectorAll('#day-dow-specific-grid input[type="checkbox"]').forEach(cb => {
                cb.addEventListener('change', () => {
                    selectedDaysOfWeek = Array.from(document.querySelectorAll('#day-dow-specific-grid input[type="checkbox"]'))
                        .filter(cb => cb.checked)
                        .map(cb => cb.value);
                    updateCron();
                });
            });

            // Event listeners for tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => {
                    const tabName = button.getAttribute('data-tab');
                    openTab(tabName);
                });
            });

            // Event listeners for option changes
            document.getElementById('seconds-type').addEventListener('change', updateSecondsOptions);
            document.getElementById('minutes-type').addEventListener('change', updateMinutesOptions);
            document.getElementById('hours-type').addEventListener('change', updateHoursOptions);
            document.getElementById('day-dom-type').addEventListener('change', updateDaySubOptions);
            document.getElementById('day-dow-type').addEventListener('change', updateDaySubOptions);
            document.getElementById('month-type').addEventListener('change', updateMonthOptions);
            document.getElementById('year-type').addEventListener('change', updateYearOptions);
            document.querySelectorAll('input[name="day-mode"]').forEach(radio => {
                radio.addEventListener('change', updateDayOptions);
            });

            // Add change listeners for select elements
            document.querySelectorAll('select').forEach(select => {
                select.addEventListener('change', updateCron);
            });

            // Add input listener for year-specific input
            document.getElementById('year-specific-input').addEventListener('input', updateCron);

            // Initial setup
            updateSecondsOptions();
            updateMinutesOptions();
            updateHoursOptions();
            updateDayOptions();
            updateMonthOptions();
            updateYearOptions();
            updateCron();
        }

        // Run initialization
        init();
    </script>
</body>
</html>
